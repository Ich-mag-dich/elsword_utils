<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="./Dius_Aer.png" type="image/x-icon" />
    <title>엘소드 공명도 계산기</title>
    <script src="https://www.ashal.eu/javascript/calcs/erp_exp_list.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .nanum-gothic {
        font-family: "Nanum Gothic", serif;
        font-weight: 700;
        font-style: normal;
      }
      .nanum-gothic-gray {
        font-family: "Nanum Gothic", serif;
        font-weight: 700;
        font-style: normal;
        color: gray;
      }
      .container {
        /* max-width: 600px; */
        margin: 0 auto;
      }

      @media (min-width: 1200px) {
        .extContainer {
          display: flex;
        }
        .container2 {
          width: 500px;
        }
      }
      @media (max-width: 1200px) {
        .container2 {
          margin-top: 20px;
        }
      }
      label,
      input {
        margin: 10px 0;
      }
      button {
        margin-top: 20px;
        padding: 10px 20px;
        font-size: large;
        font-weight: bold;
        background-color: black;
        color: white;
        border: none;
        cursor: pointer;
      }
      .input-number {
        width: 100px;
        height: 40px;
        font-size: large;
        font-weight: bold;
        text-align: center;
      }
      label {
        font-size: large;
        font-weight: bold;
        margin-right: 5px;
        display: inline-block;
      }
      p {
        display: inline-block;
      }
    </style>
  </head>
  <body class="nanum-gothic">
    <div class="extContainer">
      <div
        class="container"
        style="
          /* width: 600px; */
          border: solid;
          border-width: 3px;
          border-color: black;
          padding: 30px;
        "
      >
        <h1>엘소드 공명도 계산기</h1>
        <p>
          획득하는 경험치와 ED는 보수적으로 잡았으며
          <br />
          랜덤 미션등의 변수는 고려하지 않아 계산 결과가 다를 수 있습니다.
          <br />
          Enter 키 입력으로도 계산할 수 있습니다.
        </p>
        <br />

        <hr />
        <form id="expCalculator">
          <br />
          <!-- <p style="margin-right: 20px">던전 선택</p> -->
          <div>
            <label>
              <input type="radio" name="option" value="1" checked />
              플레가스의 초상
            </label>
            <label>
              <input type="radio" name="option" value="2" />
              마그마의 숨결
            </label>
            <br />
            <label>
              <input type="radio" name="option" value="3" />
              메마른 정령의 안식처
            </label>
            <label>
              <input type="radio" name="option" value="4" />
              플레가스의 시선
            </label>
            <label>
              <input type="radio" name="option" value="5" />
              트로쉬의 둥지
            </label>
            <br /><br />
          </div>
          <hr />
          <label for="startLevel"> *시작 레벨: </label>
          <input
            type="number"
            id="startLevel"
            name="startLevel"
            min="1"
            max="998"
            style="display: inline-block"
            class="input-number"
            placeholder="0"
            required
          />
          <br />
          <label for="targetLevel">*목표 레벨: </label>
          <input
            type="number"
            id="targetLevel"
            name="targetLevel"
            min="2"
            max="999"
            style="display: inline-block"
            class="input-number"
            placeholder="0"
            required
          />
          <br />
          <hr />
          <label for="clearTime">*평균 클리어타임: </label>
          <input
            type="number"
            id="clearTime"
            name="clearTime"
            min="1"
            max="999"
            style="display: inline-block"
            class="input-number"
            placeholder="0"
            required
          />
          <br />
          <p class="nanum-gothic-gray">초 단위로 입력 ex) 1분 7초 -> 67</p>
          <hr />
          <br />
          <label for="delayTime">판당 지연시간: </label>
          <input
            type="number"
            id="delayTime"
            name="delayTime"
            min="0"
            max="999"
            style="display: inline-block"
            class="input-number"
            placeholder="8"
          />
          <br />
          <p class="nanum-gothic-gray">
            재도전시 딜레이 되는 시간 등등 필요시 입력
            <br />
            기본은 8초
          </p>
          <hr />
          <div style="display: flex">
            <label for="targetLevel">
              <p>
                *스탯창 표기<br />
                경험치 획득량 증가
              </p>
            </label>
            <input
              type="number"
              id="exp_rate"
              name="exp_rate"
              min="1"
              style="display: inline-block; margin-left: 20px; margin-top: 30px"
              class="input-number"
              placeholder="0"
              required
            />
          </div>
          <br />
          <hr />
          <div style="display: flex">
            <label for="targetLevel">
              <p>
                *스탯창 표기<br />
                ED 획득량 증가
              </p>
            </label>
            <input
              type="number"
              id="ed_rate"
              name="ed_rate"
              min="1"
              style="display: inline-block; margin-left: 20px; margin-top: 30px"
              class="input-number"
              placeholder="0"
              required
            />
          </div>
          <br />
          <hr />
          <div style="display: flex">
            <label> PC방 </label>
            <div
              style="display: inline-block; margin-left: 30px; margin-top: 3px"
            >
              <label>O</label>
              <input type="radio" name="pc" value="100" checked />
              <br />
              <label>X</label>
              <input type="radio" name="pc" value="0" />
            </div>
          </div>
          <br />
          <hr />

          <div style="display: flex">
            <label> 길드 스킬 </label>
            <div
              style="display: inline-block; margin-left: 30px; margin-top: 3px"
            >
              <label>O</label>
              <input type="radio" name="guild_skill" value="15" checked />
              <br />
              <label>X</label>
              <input type="radio" name="guild_skill" value="0" />
            </div>
          </div>
          <br />
          <hr />
          <div style="display: flex">
            <label> 길드 휘장 가호 </label>
            <div
              style="display: inline-block; margin-left: 30px; margin-top: 3px"
            >
              <label>O</label>
              <input type="radio" name="guild_banner" value="10" checked />
              <br />
              <label>X</label>
              <input type="radio" name="guild_banner" value="0" />
            </div>
          </div>
          <br />
          <hr />
          <div style="display: flex">
            <label> 수련 버프 </label>
            <div
              style="display: inline-block; margin-left: 30px; margin-top: 3px"
            >
              <label>O</label>
              <input type="radio" name="guild_trainig" value="50" checked />
              <br />
              <label>X</label>
              <input type="radio" name="guild_trainig" value="0" />
            </div>
          </div>
          <br />
          <hr />
          <label for="exp_medal">경험치 메달: </label>
          <input
            type="number"
            id="exp_medal"
            name="exp_medal"
            min="0"
            style="display: inline-block"
            class="input-number"
            placeholder="0"
          /><br />
          <p class="nanum-gothic-gray">(100%메달 -> 100)</p>
          <br />
          <hr />
          <label for="exp_house">온천 / 하우스: </label>
          <input
            type="number"
            id="exp_house"
            name="exp_house"
            min="0"
            style="display: inline-block"
            class="input-number"
            placeholder="0"
          /><br />
          <p class="nanum-gothic-gray">(온천 -> 30, 하우스 -> 50)</p>
          <br />
          <hr />
          <label for="exp_burning">경험치 배탐: </label>
          <input
            type="number"
            id="exp_burning"
            name="exp_burning"
            min="0"
            style="display: inline-block"
            class="input-number"
            placeholder="0"
          /><br />
          <p class="nanum-gothic-gray">(2배탐 -> 100, 3배탐 -> 200)</p>
          <br />
          <hr />
          <label for="drop_burning">드랍 배탐: </label>

          <input
            type="number"
            id="drop_burning"
            name="drop_burning"
            min="0"
            style="display: inline-block"
            class="input-number"
            placeholder="0"
          /><br />
          <p class="nanum-gothic-gray">(2배탐 -> 100, 3배탐 -> 200)</p>
          <br />
          <hr />
          <!-- <label for="els_pass">패스 마크: </label>

          <input
            type="number"
            id="els_pass"
            name="els_pass"
            min="0"
            style="display: inline-block"
            class="input-number"
            placeholder="0"
          /><br />
          <p>(엔패스 50, 엘리오스 패스 10)</p>
          <br />
          <hr /> -->
          <button type="submit">계산하기</button>
        </form>
      </div>

      <div
        class="container container2"
        style="
          /* width: 400px; */
          border: solid;
          border-width: 3px;
          border-color: black;
          padding: 30px;
          font-size: large;
          height: fit-content;
        "
      >
        <div>
          <p>목표 달성까지 필요한 경험치</p>
          <p id="requied_exp" style="font-weight: bold">0</p>
        </div>
        <hr />
        <div>
          <p>1판당 획득하는 경험치</p>
          <p id="exp_per_game" style="font-weight: bold">0</p>
        </div>
        <hr />
        <div>
          <p>1판당</p>
          <p id="ed_per_game" style="font-weight: bold">0</p>
          <p style="font-weight: bold">ED</p>
          <p>획득</p>
        </div>
        <hr />
        <div>
          <p>목표 달성까지 필요한 판 수</p>
          <p id="requied_game_count" style="font-weight: bold">0</p>
          <p style="font-weight: bold">판</p>
        </div>
        <hr />
        <div>
          <p>1탐당</p>
          <p id="gameCount" style="font-weight: bold">0</p>
          <p style="font-weight: bold">판</p>
        </div>
        <hr />
        <div>
          <p>1탐당</p>
          <p id="ed_per_time" style="font-weight: bold">0</p>
          <p style="font-weight: bold">ED</p>
        </div>
        <hr />
        <div>
          <p>목표 달성까지 필요한 탐 수</p>
          <p id="requied_game_time" style="font-weight: bold">0</p>
          <p style="font-weight: bold">탐</p>
        </div>
        <hr />
        <div>
          <p>목표 달성까지 필요한 시간</p>
          <p id="requied_time" style="font-weight: bold">0</p>
        </div>
        <hr />
        <div>
          <p>목표 달성까지</p>
          <p id="total_ed" style="font-weight: bold">0</p>
          <p style="font-weight: bold">ED</p>
          <p>획득</p>
        </div>
      </div>
    </div>
    <script>
    


      /*
      던전별 기본 경험치 및 ED 획득량 (주석: 실제 게임 내 기본값)
        트로쉬의 둥지: 8,373,708
        플레가스의 초상: 12,372,500
        마그마의 숨결: 24,695,510
      아래는 엘리트/유니크 몬스터 등 보정(13%) 적용된 값
      */

      const pleagasDefaultExp = Math.floor(12372500 * 1.095); // 13,970,925
      const pleagasDefaultEd = 220820; // 188,820

      const magmaDefaultExp = Math.floor(24695510 * 1.095); // 27,908,476
      const magmaDefaultEd = 212310; // 183,310

      const asylumDefaultExp = Math.floor(3424708 * 1.095); // 3,870,991
      const asylumDefaultEd = 245690; // 220,690

      const gazeDefaultExp = Math.floor(3444504 * 1.095); // 3,892,229
      const gazeDefaultEd = 258610; // 238,610

      const troshNestDefaultExp = Math.floor(8373708 * 1.095); // 9,463,238
      const troshNestDefaultEd = 199128; //190,128

      function radioSubmit(event) {
        if (document.getElementById("expCalculator").reportValidity()) {
          document.getElementById("expCalculator").submit();
        }
      }

      var defaultExp = 0; // 12,372,500
      var defaultEd = 0; // 188,820
      function formatDuration(totalSeconds) {
        const days = Math.floor(totalSeconds / (24 * 3600));
        totalSeconds %= 24 * 3600;
        const hours = Math.floor(totalSeconds / 3600);
        totalSeconds %= 3600;
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        let result = "";
        if (days > 0) {
          result += days + " 일 ";
        }
        if (hours > 0) {
          result += hours + " 시간 ";
        }
        if (minutes > 0) {
          result += minutes + " 분 ";
        }

        return result.trim();
      }

      const getExp = (startLevel, targetLevel) => {
        return (
          parseInt(required_exp_table[targetLevel - 1]) -
          parseInt(required_exp_table[startLevel - 1])
        );
      };

      // console.log(required_exp_table[998]);

      document
        .getElementById("expCalculator")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          const selectedOption = document.querySelector(
            'input[name="option"]:checked'
          ).value;
          // 던전 선택에 따라 보정된 경험치/ED 사용
          if (selectedOption === "1") {
            defaultExp = pleagasDefaultExp;
            defaultEd = pleagasDefaultEd;
          } else if (selectedOption === "2") {
            defaultExp = magmaDefaultExp;
            defaultEd = magmaDefaultEd;
          } else if (selectedOption === "3") {
            defaultExp = asylumDefaultExp;
            defaultEd = asylumDefaultEd;
          } else if (selectedOption === "4") {
            defaultExp = gazeDefaultExp;
            defaultEd = gazeDefaultEd;
          } else if (selectedOption === "5") {
            defaultExp = troshNestDefaultExp;
            defaultEd = troshNestDefaultEd;
          }
          const startLevel = parseInt(
            document.getElementById("startLevel").value
          );
          const targetLevel = parseInt(
            document.getElementById("targetLevel").value
          );
          const clearTime = parseInt(
            document.getElementById("clearTime").value
          );
          const delayTime =
            parseInt(document.getElementById("delayTime").value) || 8;
          const stat_exp_rate = parseInt(
            document.getElementById("exp_rate").value
          );
          const stat_ed_rate = parseInt(
            document.getElementById("ed_rate").value
          );
          const guild_skill = parseInt(
            document.querySelector('input[name="guild_skill"]:checked').value
          );
          const guild_banner = parseInt(
            document.querySelector('input[name="guild_banner"]:checked').value
          );
          const pc = parseInt(
            document.querySelector('input[name="pc"]:checked').value
          );

          let result = 0;
          const exp_medal =
            parseInt(document.getElementById("exp_medal").value) || 0;

          const exp_house =
            parseInt(document.getElementById("exp_house").value) || 0;
          const exp_burning =
            parseInt(document.getElementById("exp_burning").value) || 0;
          const drop_burning =
            parseInt(document.getElementById("drop_burning").value) || 0;
          const guild_trainig = parseInt(
            document.querySelector('input[name="guild_trainig"]:checked').value
          );

          console.log(
            stat_exp_rate,"스탯 exp rate",
            guild_skill, "길드 스킬",
            guild_banner,"길드 휘장",
            pc,"PC",
            exp_medal,"경험치 메달 ",
            exp_house,"경험치 하우스 ",
            exp_burning,"경험치 버닝 ",
            drop_burning,"드랍 버닝 ",
            guild_trainig, "길드 수련 "
          );

          if (startLevel >= targetLevel) {
            alert("시작 레벨이 목표 레벨보다 높습니다.");
            return;
          } else {
            // 수상(10%)과 클리어(30%)를 경획에 합산
            const total_exp_gain = stat_exp_rate + guild_skill + guild_banner + 10 + 30;
            // 경험치 보너스: PC방, 메달, 하우스, 배탐, 수련, 기타(130)
            const total_exp_bonus = pc + exp_medal + exp_house + exp_burning + guild_trainig + 130;
            result =
              ((defaultExp * (total_exp_gain + 100)) / 100) *
              (total_exp_bonus / 100);
          }
          const requiredExp = getExp(startLevel, targetLevel);

          document.getElementById("requied_exp").innerText =
            requiredExp.toLocaleString();
          document.getElementById("exp_per_game").innerText =
          Math.floor(result).toLocaleString();
          document.getElementById("ed_per_game").innerText = (
            (defaultEd *
              ((100 + stat_ed_rate  - 5) *
                ((pc + drop_burning + 100) / 100))) /
            100
          ).toLocaleString();
          document.getElementById("ed_per_time").innerText = (
            ((defaultEd *
              ((100 + stat_ed_rate  - 5) *
                ((pc + drop_burning + 100) / 100))) /
              100) *
            Math.floor(1800 / (clearTime + delayTime))
          ).toLocaleString();
          document.getElementById("requied_game_count").innerText = Math.floor(
            requiredExp / result
          );
          document.getElementById("gameCount").innerText = Math.floor(
            1800 / (clearTime + delayTime)
          );
          const requied_game_time = Math.floor(
            requiredExp / (result * Math.floor(1800 / (clearTime + delayTime)))
          );
          const requied_time = requied_game_time * 30 * 60;
          document.getElementById("requied_game_time").innerText =
            requied_game_time;
          document.getElementById("requied_time").innerText =
            formatDuration(requied_time);
          document.getElementById("total_ed").innerText = (
            ((defaultEd *
              ((100 + stat_ed_rate  - 5) *
                ((pc + drop_burning + 100) / 100))) /
              100) *
            Math.floor(requiredExp / result)
          ).toLocaleString();
          if (window.innerWidth > 1200) {
            window.scrollTo({ top: 0, behavior: "smooth" });
          }
        });
    </script>
  </body>
</html>
